
自创证书
 mkdir https
cd https/
cfssl print-defaults csr > ca-csr.json

cat << EOF > ca-csr.json
{
    "CN": "hx",
    "key": {
        "algo": "rsa",
        "size": 2048
    },
    "names": [
        {
            "C": "CN",
            "L": "Beijing",
            "ST": "Beijing"
        }
    ]
}
EOF 



cfssl print-defaults config > ca-config.json

cfssl gencert --initca ca-csr.json | cfssljson -bare ca -

cfssl print-defaults csr > server-csr.json

cat << EOF > server-csr.json

{
    "CN": "www.aliangedu.com",
    "key": {
        "algo": "rsa",
        "size": 2048
    },
    "names": [
        {
            "C": "CN",
            "L": "Beijing",
            "ST": "Beijing"
        }
    ]
}
EOF


cfssl gencert -ca=ca.pem -ca-key=ca-key.pem --config=ca-config.json --profile=www server-csr.json | cfssljson -bare server

 kubectl create secret tls aliangedu-https --key server-key.pem --cert server.pem



cat << EOF> https.yaml
apiVersion: extensions/v1beta1
kind: Ingress
metadata:
  name: https-test
spec:
  tls:
  - hosts:
    - www.aliangedu.com
    secretName: aliangedu-https
  rules:
  - host: www.aliangedu.com
    http:
      paths:
      - backend:
          serviceName: nginx
          servicePort: 80
EOF

 kubectl create -f https.yaml






 
[root@k8s-master ingress]# kubectl get ing
NAME         HOSTS                     ADDRESS   PORTS     AGE
httpd-test   foo.bar.com,bar.baz.com             80        1h
https-test   www.aliangedu.com                   80, 443   46s


注意：以下黄色部分必须要一致
[root@k8s-master ingress]# kubectl get secret
NAME                  TYPE                                  DATA      AGE
aliangedu-https       kubernetes.io/tls                     2         12m
 
